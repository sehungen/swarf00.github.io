---
layout: article
title: ì‚¬ìš©ìì¸ì¦(4)
excerpt: ì¥ê³ (Django) ì›¹í”„ë ˆì„ì›Œí¬ì—ì„œ ì†Œì…œë¡œê·¸ì¸(oauth)ë¥¼ ì´ìš©í•˜ì—¬ ë¡œê·¸ì¸ ë° íšŒì›ê°€ì…ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë´…ë‹ˆë‹¤.ëª¨ë¸í¼ì„ ì´ìš©í•˜ì—¬ ì‰½ê²Œ í…œí”Œë¦¿ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë´…ë‹ˆë‹¤.
key: django-authentication-04
aside:
  toc: true
sidebar:
  nav: docs-ko
mermaid: true
pageview: true
date: 2018/12/19
tags: ì¥ê³  Django auth ê°„í¸ë¡œê·¸ì¸ ì†Œì…œë¡œê·¸ì¸ oauth naver kakao ë„¤ì´ë²„ ë„¤ì•„ë¡œ django-allauth ì¸ì¦ë°±ì—”ë“œ login authenticate ModelBackend ì‹±ê¸€í„´ singleton requests
metadata:
  og_title: ì¥ê³ (Django) ì‚¬ìš©ìì¸ì¦ ì œ 4 í¸
  og_type: article
  og_locale: ko_KR
  og_description: ì¥ê³ (Django) ì›¹í”„ë ˆì„ì›Œí¬ì—ì„œ ì†Œì…œë¡œê·¸ì¸(oauth)ë¥¼ ì´ìš©í•˜ì—¬ ë¡œê·¸ì¸ ë° íšŒì›ê°€ì…ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë´…ë‹ˆë‹¤.
  og_site_name: ì¥ê³ (Django) í•¥ì§ ë§›ë³´ê¸°
---
## 1. ì†Œì…œë¡œê·¸ì¸

ì•ì„œ ì¸ì¦ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì‚´í´ë´¤ëŠ”ë° ë¡œì»¬ì—ì„œ íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸ì€ ì‚¬ìš©ìì—ê²Œ ë¶ˆí¸í•¨ê³¼ ë¶ˆì•ˆí•¨ì„ ê°€ì ¸ë‹¤ ì£¼ê¸°ë„ í•©ë‹ˆë‹¤. ì—¬ëŸ¬ë¶„ì€ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•˜ê³  ìˆë”ë¼ë„ ì‚¬ìš©ìëŠ” ê·¸ê²ƒì„ ì•Œ ìˆ˜ ì—†ê¸°ì— ìê¸° ìì‹ ì˜ ì •ë³´ë¥¼ ì—¬ëŸ¬ë¶„ì˜ ì„œë¹„ìŠ¤ì— ì €ì¥í•˜ëŠ” ê²ƒì— ë¶€ë‹´ê°ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²Œë‹¤ê°€ ëª¨ë°”ì¼ë¡œ ì ‘ì†í•œ ì‚¬ìš©ìë¼ë©´ ì´ë©”ì¼ ì£¼ì†Œ í•˜ë‚˜ë§Œ ì…ë ¥í•˜ë”ë¼ë„ í”¼ê³¤í•˜ë‹¤ê³  ëŠë‚„ ê²ƒì´ê³  ëª¨ë°”ì¼ì˜ í„°ì¹˜í‚¤ë³´ë“œ ë–„ë¬¸ì— ì˜¤íƒ€ë¡œ ì¸í•œ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì¢€ ë” ë¹ ë¥´ê³  í¸í•œ ì¸ì¦ ë°©ì‹ì„ ì œê³µí•´ì£¼ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.  
ì¸ì¦ì´ ë°˜ë“œì‹œ í•„ìš”í•œ ì„œë¹„ìŠ¤ë¼ë©´ ì´ë©”ì¼ ê¸°ë°˜ì˜ ë¡œì»¬ì¸ì¦ ì‹œìŠ¤í…œë§Œ ì œê³µí•˜ëŠ” ê²ƒì€ ì‚¬ìš©ì ì…ì¥ì—ì„œëŠ” ë‚œê°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ´ ë•Œ ì´ë¯¸ ë§ì€ **ì‚¬ìš©ìë“¤ì—ê²Œ ì‹ ë¢°ë¥¼ ë°›ê³  ìˆìœ¼ë©° ì¶©ë¶„íˆ ë§ì€ ì‚¬ìš©ìë¥¼ ë³´ìœ í•œ ì„œë¹„ìŠ¤ì—ê²Œ ì¸ì¦ê¸°ëŠ¥ì„ ìœ„ì„í•´ì„œ ì¸ì¦ê²°ê³¼ë§Œ ë°›ì•„ë³¼ ìˆ˜ ìˆëŠ” ë°©ë²•**ì´ ìˆìŠµë‹ˆë‹¤. `ê°„í¸ë¡œê·¸ì¸`ì´ë¼ê³  ë¶€ë¥´ê¸°ë„ í•˜ê³  `ì†Œì…œë¡œê·¸ì¸`ì´ë¼ê³ ë„ ë¶€ë¥´ê¸°ë„ í•˜ëŠ” ê¸°ëŠ¥ì¸ë° ì´ë¦„ì€ ì–´ì°Œë˜ì—ˆë“  ì‚¬ìš©ìì™€ ê°œë°œì ì…ì¥ì—ì„œ ê°„í¸í•˜ê³  ì•ˆì „í•˜ê²Œ ì¸ì¦ì„ í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì…ë‹ˆë‹¤. ì´ì„±ì ìœ¼ë¡œ ê°„í¸ë¡œê·¸ì¸ì´ë¼ëŠ” ìš©ì–´ê°€ ë§ì„ ê²ƒ ê°™ì€ë° ì¥ê³  ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ì£¼ë¡œ ì†Œì…œë¡œê·¸ì¸ì´ë¼ ë¶€ë¥´ê¸° ë•Œë¬¸ì— ì—¬ê¸°ì„œë„ ì†Œì…œë¡œê·¸ì¸ì´ë¼ê³  í•˜ê² ìŠµë‹ˆë‹¤.

### oauth ì†Œê°œ

ì†Œì…œë¡œê·¸ì¸ì€ `oauth` ë¼ëŠ” ì¸ì¦ í”„ë¡œí† ì½œì„ êµ¬í˜„í•œ apië¥¼ ì™¸ë¶€ì— ê³µê°œí•´ì„œ **ëˆ„êµ¬ë¼ë„`ì¸ì¦(authentication)`ê³¼ `ê¶Œí•œí—ˆê°€(authorization)`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì œê³µí•˜ëŠ” api** ì…ë‹ˆë‹¤. í˜„ì¬ oauthëŠ” 2.0 ë²„ì „ê¹Œì§€ ë‚˜ì™€ ìˆì§€ë§Œ ì†Œì…œë¡œê·¸ì¸ api ì œê³µ ì„œë¹„ìŠ¤ë§ˆë‹¤ êµ¬í˜„ëœ í”„ë¡œí† ì½œì´ ë‹¤ì–‘í•©ë‹ˆë‹¤. êµ­ë‚´ë³´ë‹¤ í•´ì™¸ì—ì„œ oauth 2.0 ë²„ì „ì„ ì§€ì›í•˜ëŠ” ê³³ì´ ë” ë§ìŠµë‹ˆë‹¤. ì•„ë¬´ë˜ë„ 1.0 ë²„ì „ì˜ ë³´ì•ˆ ì·¨ì•½ì„±ì„ ê°œì„ í•œ 2.0 ë²„ì „ì„ ì„ í˜¸í•˜ê¸° ë•Œë¬¸ì¸ë° êµ­ë‚´ ì„œë¹„ìŠ¤ë“¤ë„ 2.0 ë²„ì „ì„ ì§€ì›í•˜ëŠ” ì‚¬ë¡€ë“¤ì´ ë§ì•„ì§€ê³  ìˆìŠµë‹ˆë‹¤.

oauth 2.0 ë²„ì „ì´ ë‚´ìš©ì„ ì´í•´í•˜ê¸°ëŠ” ê·¸ë¦¬ ì–´ë µì§€ ì•ŠìŠµë‹ˆë‹¤. api ì œê³µí•´ì•¼ í•˜ëŠ” í”„ë¡œë°”ì´ë”(authorization server or resource server) ì…ì¥ì—ì„œëŠ” ë³µì¡í•˜ì§€ë§Œ ê° í”„ë¡œë°”ì´ë”ë“¤ì´ ì œê³µí•˜ëŠ” apië¥¼ ì‚¬ìš©í•˜ëŠ” ì—¬ëŸ¬ë¶„ì˜ ì„œë¹„ìŠ¤(client) ì…ì¥ì—ì„œëŠ” ëª‡ ê°€ì§€ë§Œ êµ¬í˜„í•´ì£¼ë©´ ë©ë‹ˆë‹¤. **ë¨¼ì € oauth 2.0 ì— ëŒ€í•´ ì˜ ì •ë¦¬ëœ [ë¬¸ì„œ](https://meetup.toast.com/posts/105)ë¥¼ ì½ì–´ ë³´ì‹œê³ ** ì•„ë˜ ë‚´ìš©ì„ ë”°ë¼í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤.  
í•œê°€ì§€ ì†Œì…œë¡œê·¸ì¸ì„ êµ¬í˜„í•´ ë³´ë©´ ë‚˜ë¨¸ì§€ ì„œë¹„ìŠ¤ë“¤ë„ ë¹„ìŠ·í•˜ê²Œ êµ¬í˜„í•´ë³´ì‹¤ ìˆ˜ ìˆì„ ê²ë‹ˆë‹¤. ë¨¼ì € ìš°ë¼ë‚˜ë¼ì—ì„œ ê°€ì¥ ë§ì€ ì‚¬ìš©ìë¥¼ ë³´ìœ í•œ ë„¤ì´ë²„ ë¡œê·¸ì¸ apië¡œ ì†Œì…œë¡œê·¸ì¸ ê¸°ëŠ¥ì„ êµ¬í˜„í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.


### ë„¤ì´ë²„ ì†Œì…œë¡œê·¸ì¸ [ë„¤ì•„ë¡œ] ì•± ë“±ë¡
[django-allauth](https://django-allauth.readthedocs.io/en/latest/) ì—ì„œëŠ” ë„¤ì´ë²„, ì¹´ì¹´ì˜¤ ë“± ë‹¤ë¥¸ ì—¬ëŸ¬ ì„œë¹„ìŠ¤ë“¤ì— ëŒ€í•œ ì†Œì…œë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ”ë° ë¹ ë¥´ê³  í¸í•˜ê²Œ ì—¬ëŸ¬ ì†Œì…œë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ì œê³µí•˜ê³  ì‹¶ìœ¼ì‹  ë¶„ë“¤ì´ ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì‹œê³  ì†Œì…œë¡œê·¸ì¸ì˜ êµ¬í˜„ë°©ë²•ì„ ì¢€ ë” ìì„¸íˆ ì•Œê³  ì‹¶ìœ¼ì‹  ë¶„ë“¤ì€ ì—¬ê¸°ì— ë‚˜ì˜¨ ë°©ì‹ì„ ë”°ë¼í•˜ë©´ì„œ ê³µë¶€í•´ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> django-aullauth ëŠ” ì„¤ì •ì„ database(admin ì‚¬ì´íŠ¸) ë¡œ í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë‹¤ì–‘í•œ í”„ë¡œë°”ì´ë”ë¥¼ ê°ê° ì„¤ì •í•˜ê¸°ì— ìš©ì´í•œ ë©´ì´ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì—ì„œëŠ” ë„¤ì´ë²„ì˜ ì†Œì…œë¡œê·¸ì¸ë§Œ êµ¬í˜„í•˜ê¸° ë•Œë¬¸ì— ì„¤ì •íŒŒì¼ì— ì„¤ì •í•˜ëŠ” ê²ƒìœ¼ë¡œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. ì—¬ëŸ¬ë¶„ì˜ í¸ì˜ì— ë”°ë¼ ì„¤ì •ê°’ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ë„ë¡ ë³€ê²½í•˜ì…”ë„ ì¢‹ìŠµë‹ˆë‹¤.

ë¨¼ì € ë„¤ì´ë²„ ì†Œì…œë¡œê·¸ì¸ì„ ì‚¬ìš©í•˜ë ¤ë©´ ì‚¬ìš©ê¶Œí•œì„ ì–»ì–´ì•¼ í•©ë‹ˆë‹¤. ë„¤ì´ë²„ [ê°œë°œìì„¼í„°](https://developers.naver.com/apps/#/register)ì—ì„œ ì—¬ëŸ¬ë¶„ì˜ ì•±ì„ ë“±ë¡í•˜ê³  ëª‡ê°€ì§€ ì„¤ì •ì„ í•˜ë©´ ì‚¬ìš©í—ˆê°€ê°€ ë©ë‹ˆë‹¤. 

1. ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¦„ ì…ë ¥
2. ì‚¬ìš© API ì„ íƒ - ë„¤ì•„ë¡œ (ë„¤ì´ë²„ ì•„ì´ë””ë¡œ ë¡œê·¸ì¸)
3. í•„ìˆ˜ê¶Œí•œ ì„ íƒ - íšŒì›ì´ë¦„, ì´ë©”ì¼ (ê·¸ ì™¸ì— ì—¬ëŸ¬ë¶„ì´ í•„ìš”í•œ ê²ƒë“¤)
4. ì„œë¹„ìŠ¤ í™˜ê²½ ì¶”ê°€ - PC ì›¹
5. ì„œë¹„ìŠ¤ URL ì…ë ¥ - http://localhost:8000
6. Callback URL ì…ë ¥ - http://localhost:8000/user/login/social/naver/callback/
7. ë“±ë¡í•˜ê¸° ë²„íŠ¼ í´ë¦­

![ë„¤ì´ë²„ ì•±ë“±ë¡ 01]({{ site.url }}/snapshots/naver_app_register_01.png)

ì‚¬ìš© API ì™€ ì„œë¹„ìŠ¤ í™˜ê²½ ì¶”ê°€ëŠ” ì›í•˜ëŠ” ê²ƒë“¤ì„ ì„ íƒí•  ë•Œë§ˆë‹¤ ì¶”ê°€ê°€ ë©ë‹ˆë‹¤. ì—¬ê¸°ì—ì„œ ì„¤ëª…í•˜ëŠ” ë¶€ë¶„ì€ ë„¤ì´ë²„ ì†Œì…œë¡œê·¸ì¸ ì´ë¯€ë¡œ ë„¤ì•„ë¡œë§Œ ì¶”ê°€í•˜ì…”ë„ ë©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ URL ê³¼ Callback URL ì˜ ë„ë©”ì¸ì€ í˜„ì¬ ê°œë°œí™˜ê²½ì´ê¸° ë•Œë¬¸ì— localhost:8000ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤. ì—¬ëŸ¬ë¶„ì˜ ë„ë©”ì¸ì´ ìˆê³  í•´ë‹¹ **ë„ë©”ì¸ìœ¼ë¡œ ì—°ê²°ëœ ì„œë²„ì— ë°°í¬í•  ë•Œ ë°˜ë“œì‹œ ìˆ˜ì •**í•´ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤. Callback URL ì€ `input` ì¹¸ ì˜†ì— ìˆëŠ” + ë²„íŠ¼ì„ ëˆ„ë¥´ì…”ì„œ ë‘ê°œ ì´ìƒì˜ URLì„ ì…ë ¥ê°€ëŠ¥í•©ë‹ˆë‹¤. ë‚˜ì¤‘ì— ì¥ê³ ì•±ì—ì„œ ë¡œê·¸ì¸ì„ ì—°ë™í•  ë•Œ ë°˜ë“œì‹œ ì—¬ê¸°ì— ë“±ë¡ëœ Callback URL ì¤‘ì— í•˜ë‚˜ë¥¼ ì‚¬ìš©í•´ì•¼ ë©ë‹ˆë‹¤. 

![ë„¤ì´ë²„ ì•±ë“±ë¡ 02]({{ site.url }}/snapshots/naver_app_register_02.png)

> Callback URL ì„ ì—¬ëŸ¬ê°œ ë“±ë¡í•˜ë©´ ì¼€ì´ìŠ¤ë§ˆë‹¤ ë„¤ì´ë²„ ë¡œê·¸ì¸ ì´í›„ì˜ ì²˜ë¦¬ë°©ì‹ì„ ë‹¬ë¦¬ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë„¤ì´ë²„ javascript sdkë¥¼ ì‚¬ìš©í•˜ë©´ ë¸Œë¼ìš°ì €ì—ì„œ í¸ë¦¬í•˜ê²Œ access_token ì„ ë°›ì•„ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ë˜ë©´ ì„œë²„ì—ì„œ access_tokenì— ëŒ€í•´ì„œ ê²€ì¦ì„ í•  í•„ìš”ê°€ ì—†ê²Œ ë©ë‹ˆë‹¤(ì‚¬ì‹¤ì€ ê²€ì¦í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤). ì—¬ê¸°ì„œëŠ” ë„¤ì´ë²„ sdkë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ì„œë²„ì—ì„œ ì¸ì¦ì²˜ë¦¬ë¥¼ í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤. ê²½ìš°ì— ë”°ë¼ì„œ ë‘ ê°€ì§€ ë°©ì‹ ëª¨ë‘ ì œê³µí•´ì•¼ í•œë‹¤ë©´ ê° ì¼€ì´ìŠ¤ë§ˆë‹¤ Callback URL ë¶„ë¦¬í•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒë„ ì¢‹ì€ ë°©ë²•ì…ë‹ˆë‹¤.

ì•±ì´ ì˜ ë“±ë¡ì´ ë˜ì—ˆë‹¤ë©´ [ì•± ëª©ë¡](https://developers.naver.com/apps/#/list)ì—ì„œ ì—¬ëŸ¬ë¶„ì´ ë“±ë¡í•œ ì•±ì„ ì„ íƒí•´ì„œ ì•± ì •ë³´ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. Client ID ì™€ Client Secret ë‘ê°€ì§€ë¥¼ ë³µì‚¬í•´ì„œ ì„¤ì •íŒŒì¼ì— ì„¤ì •í•©ë‹ˆë‹¤. Client Secret ëŠ” ë³´ê¸° ë²„íŠ¼ì„ í´ë¦­í•˜ì…”ì•¼ ë‚´ìš©ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. **Client Secret ëŠ” ì†ŒìŠ¤ì½”ë“œ ì™¸ì—ëŠ” ë³µì‚¬ë¥¼ í•˜ì…”ë„ ì•ˆ ë˜ê³  ì™¸ë¶€ì— ë…¸ì¶œë˜ì§€ ì•Šë„ë¡ ì£¼ì˜**í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.

![ë„¤ì´ë²„ ì•±ë“±ë¡ 03]({{ site.url }}/snapshots/naver_app_register_03.png)

```python
# minitutorial/settings.py

# ìƒëµ

NAVER_CLIENT_ID = 'your client id'
NAVER_SECRET_KEY = 'your secret key'

# ìƒëµ
```

> ê³µê°œëœ git repositoryì— ê´€ë¦¬í•  ê²½ìš° ì„¤ì •íŒŒì¼ì— ë¯¼ê°í•œ ë‚´ìš©ì€ í‘¸ì‹œë˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì„¸ìš”.

ë„¤ì´ë²„ ë¡œê·¸ì¸ì— ì‚¬ìš©ë˜ëŠ” ë²„íŠ¼ì´ë¯¸ì§€ë„ [ë„¤ì´ë²„](https://developers.naver.com/inc/devcenter/downloads/naveridro/2014_Login_with_NAVER_button_png.zip)ì—ì„œ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤. sdk ë¥¼ ì‚¬ìš©í•˜ì‹ ë‹¤ë©´ í•„ìš”ì—†ê² ì§€ë§Œ ì—¬ê¸°ì—ì„œëŠ” sdkë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë¡œê·¸ì¸ë²„íŠ¼ì„ ë§Œë“¤ì–´ì¤˜ì•¼ í•©ë‹ˆë‹¤(cssë¡œ ì˜ ë””ìì¸ í•˜ì…”ë„ ë©ë‹ˆë‹¤.). ë”°ë¡œ ë¡œê·¸ì¸ë²„íŠ¼ì„ ë§Œë“¤ê¸° ì–´ë ¤ìš´ ìƒí™©ì´ë¼ë©´ [ì´ê±¸](https://developers.naver.com/inc/devcenter/downloads/naveridro/2014_Login_with_NAVER_button_png.zip) ì´ìš©í•˜ì…”ë„ ë©ë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œí•´ì„œ ì••ì¶•ì„ í’€ì–´ë³´ë©´ ë‹¤ì–‘í•œ ë²„íŠ¼ì´ë¯¸ì§€ë“¤ì´ ìˆìŠµë‹ˆë‹¤. ì €ëŠ” ì™„ì„±í˜• ë²„íŠ¼ì„ ì‚¬ìš©í•  ì˜ˆì •ì¸ë° í‰ìƒì‹œì—ëŠ” ë…¹ìƒ‰ì´ì—ˆë‹¤ê°€ hover ìƒíƒœê°€ ë˜ë©´ í°ìƒ‰ë²„íŠ¼ìœ¼ë¡œ ë°”ë€Œê²Œ í•  ì˜ˆì •ì…ë‹ˆë‹¤.`á„‚á…¦á„‹á…µá„‡á…¥ á„‹á…¡á„‹á…µá„ƒá…µá„…á…© á„…á…©á„€á…³á„‹á…µá†«_ì™„ì„±í˜•_Green.PNG`ê³¼ `á„‚á…¦á„‹á…µá„‡á…¥ á„‹á…¡á„‹á…µá„ƒá…µá„…á…© á„…á…©á„€á…³á„‹á…µá†«_ì™„ì„±í˜•_White.PNG` ë‘ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•  ê²ƒì¸ë° íŒŒì¼ì´ë¦„ì— í•œê¸€ê³¼ ê³µë°±ë¬¸ìê°€ í¬í•¨ë˜ì–´ ì´ë¦„ì„ ë³€ê²½í•  ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤. ê°ê° íŒŒì¼ì´ë¦„ì„ `naver_login_green.png`, `naver_login_white.png` ìœ¼ë¡œ ë³€ê²½í•´ì„œ user/static/user/img ë””ë ‰í† ë¦¬ì— ì €ì¥í•©ë‹ˆë‹¤. 

### ë„¤ì´ë²„ ì†Œì…œë¡œê·¸ì¸ í…œí”Œë¦¿ ìƒì„±
ì—¬ê¸°ì„œëŠ” ë·°ë³´ë‹¤ ë¨¼ì € í…œí”Œë¦¿ì„ ë§Œë“¤ ê²ƒì…ë‹ˆë‹¤. ê¸°ì¡´ ë¡œê·¸ì¸ ê¸°ëŠ¥ê³¼ í•¨ê»˜ ì†Œì…œë¡œê·¸ì¸ì„ ì œê³µí•  ì˜ˆì •ì´ì–´ì„œ `login_form.html` ì˜ content ë¸”ë¡ ìƒë‹¨ì— `include` í…œí”Œë¦¿íƒœê·¸ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

```html
<!-- user/templates/user/login_form.html -->

{% raw %}
{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block title %}<title>ë¡œê·¸ì¸</title>{% endblock %}

{% block css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'user/css/user.css' %}">
{% endblock css %}

{% block content %}

{% include 'user/partials/social_login_panel.html' %}

<div class="panel panel-default user-panel">
    <div class="panel-heading">
        ë¡œê·¸ì¸í•˜ê¸°
    </div>
    <div class="panel-body">
        <form action="." method="post">
            {% csrf_token %}
            {% include 'user/partials/form_field.html' with form=form %}
            <div class="form-actions">
                <button class="btn btn-primary btn-large" type="submit">ë¡œê·¸ì¸í•˜ê¸°</button>
            </div>
            <a href="/user/resend_verify_email/">
                <div class="link-below-button">ì¸ì¦ì´ë©”ì¼ ì¬ë°œì†¡</div>
            </a>
        </form>
    </div>
</div>
{% endblock content %}
{% endraw %}
```

ê¸°ì¡´ ë¡œê·¸ì¸ê³¼ ë™ì¼í•œ í™”ë©´ì—ì„œ ë³´ì—¬ì§€ì§€ë§Œ ë¶„ë¦¬í•´ë‘ëŠ”ê²Œ ì†ŒìŠ¤ì½”ë“œë¥¼ ë³´ê¸°ì—ë„ ì¢‹ê³ , ë¡œê·¸ì¸ ì™¸ì˜ ë‹¤ë¥¸ í™”ë©´ì—ì„œë„ ì‚¬ìš©í•˜ê¸°ì— ì¢‹ìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— ê°€ì…í•˜ê¸° í™”ë©´ì—ì„œë„ ì†Œì…œë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ì¶”ê°€í•  ê±´ë° ë™ì¼í•˜ê²Œ `include` í…œí”Œë¦¿íƒœê·¸ë§Œ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤. `social_login_panel.html` íŒŒì¼ì„ í•˜ë‚˜ ë§Œë“œì…”ì„œ ì•„ë˜ì™€ ê°™ì´ ì¶”ê°€í•©ë‹ˆë‹¤.

```html
<!-- user/templates/user/partials/form_field.html -->

{% raw %}
{% load static %}

{% static 'user/img/kakao_login.png' as kakao_button %}
{% static 'user/img/kakao_login_ov.png' as kakao_button_hover %}
{% static 'user/img/naver_login_green.png' as naver_button %}
{% static 'user/img/naver_login_white.png' as naver_button_hover %}

<div class="panel panel-default user-panel">
    <div class="panel-heading">
        ì†Œì…œë¡œê·¸ì¸
    </div>
    <div class="panel-body text-center">
        <div class="pull-left">
            <a>
                <img src="{{ kakao_button }}"
                     onmouseover="this.src='{{ kakao_button_hover }}'"
                     onmouseleave="this.src='{{ kakao_button }}'"height="34">
            </a>
        </div>
        <div class="pull-right">
            <a href="#" onclick="naverLogin()">
                <img src="{{ naver_button }}"
                     onmouseover="this.src='{{ naver_button_hover }}'"
                     onmouseleave="this.src='{{ naver_button }}'"height="34">
            </a>
        </div>
    </div>
</div>
{% endraw %}
```

ë¨¼ì € ìƒë‹¨ì— `static` í…œí”Œë¦¿íƒœê·¸ì˜ ë Œë”ë§ ëœ ë¬¸ìì—´ì„ as ë³€ìˆ˜ëª… ìœ¼ë¡œ ë³€ìˆ˜ì— ì €ì¥ì„ í•˜ê³  ì´í›„ img íƒœê·¸ì˜ `src` ì†ì„±ì—ëŠ” ì´ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. `static` í…œí”Œë¦¿íƒœê·¸ê°€ ë°˜ë³µë˜ëŠ” ê²½ìš°ì—ëŠ” ì´ë ‡ê²Œ ë³€ìˆ˜ì— ì €ì¥í•˜ë©´ ì¢€ ë” ê¹”ë”í•˜ê²Œ ì½”ë“œë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ê¹Œ ì €ì¥í•œ ë„¤ì´ë²„ ë²„íŠ¼ì„ í™”ë©´ì— ì¶œë ¥í•´ë³´ë‹ˆ ë¹ˆ ê³µê°„ì´ ë„ˆë¬´ ë§ì´ ë‚¨ì•„ì„œ ì¹´ì¹´ì˜¤ ì†Œì…œë¡œê·¸ì¸ ë²„íŠ¼ë„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼ì€ [ì—¬ê¸°](https://developers.kakao.com/assets/img/about/logos/login/kr/kakao_account_login_btn_medium_narrow.zip) ì—ì„œ ë‹¤ìš´ë¡œë“œ í•˜ì‹œê³  user/static/user/img ë””ë ‰í† ë¦¬ì— ê°ê°` kakao_login.png`, `kakao_login_ov.png` ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì €ì¥í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

ê° ë¡œê·¸ì¸ ë²„íŠ¼ì˜ `src`, `onmouseover`, `onmouseleave` ì†ì„±ê°’ì„ ì„¤ëª…í•´ ë“œë¦¬ë©´ src ëŠ” img ì˜ ê¸°ë³¸ ì´ë¯¸ì§€ url ì…ë‹ˆë‹¤. ë§ˆìš°ìŠ¤ê°€ ë²„íŠ¼ ìœ„ì— ì˜¬ë¼ê°€ë©´ `onmouseover`ì— ë“±ë¡ëœ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ì–´ ì´ë¯¸ì§€ì˜ `src` ë¥¼ ë³€ê²½í•˜ê²Œ ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë§ˆìš°ìŠ¤ê°€ ë²„íŠ¼ì—ì„œ ë²—ì–´ë‚˜ë©´ `onmouseleave`ì— ë“±ë¡ëœ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ì–´ ì›ë˜ì˜ ì´ë¯¸ì§€ë¡œ ë³€ê²½ì´ ë©ë‹ˆë‹¤.

> ì—¬ê¸°ì„œëŠ” ì¹´ì¹´ì˜¤ ì†Œì…œë¡œê·¸ì¸ì€ êµ¬í˜„í•˜ì§€ ì•Šì„ ì˜ˆì •ì´ì§€ë§Œ ë„¤ì´ë²„ ì†Œì…œë¡œê·¸ì¸ì„ ë°°ìš°ì‹œê³  ê°œì¸ì ìœ¼ë¡œ êµ¬í˜„í•´ë³´ì‹œê¸¸ ê¶Œí•©ë‹ˆë‹¤.

ë„¤ì´ë²„ ì†Œì…œë¡œê·¸ì¸ ë²„íŠ¼ì´ë¯¸ì§€ê°€ `a` íƒœê·¸ë¡œ ê°ì‹¸ìˆê³  `onclick` ì†ì„±ì— `naverLogin()` ë¥¼ í˜¸ì¶œí•˜ë„ë¡ ë°”ì¸ë“œí–ˆìŠµë‹ˆë‹¤. **`naverLogin` í•¨ìˆ˜ëŠ” ë„¤ì´ë²„ ì¸ì¦í˜ì´ì§€ë¡œ í™”ë©´ì„ ì´ë™ì‹œì¼œ ì‚¬ìš©ìë¡¤ ë¡œê·¸ì¸í•˜ê³ , ì‚¬ìš©ìë¡œë¶€í„° ì‚¬ìš©ê¶Œí•œì„ ì œê³µ**ë°›ë„ë¡ í•˜ëŠ” ê¸°ëŠ¥ì„ í•©ë‹ˆë‹¤. `naverLogin` í•¨ìˆ˜ êµ¬í˜„ì— ì•ì„œ [ë„¤ì´ë²„ ê¸°ìˆ ë¬¸ì„œ](https://developers.naver.com/docs/login/api/)ë¥¼ ë¨¼ì € ì½ì–´ë³´ì‹œê¸¸ ë°”ëë‹ˆë‹¤.

![ë„¤ì´ë²„ ì†Œì…œë¡œê·¸ì¸ 01]({{ site.url }}/snapshots/naver_social_login_01.png)

ì´ì •ë„ë§Œ í•´ë„ ê·¸ëŸ´ì‹¸í•œ ì†Œì…œë¡œê·¸ì¸ UI ê°€ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ì†Œì…œë¡œê·¸ì¸ì„ ë¡œì»¬ë¡œê·¸ì¸(ì´ë©”ì¼)ë³´ë‹¤ ìœ„ì— ìœ„ì¹˜í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤. UXì—ì„œ ë³´í†µ ë” ì„ í˜¸í•˜ëŠ” ê¸°ëŠ¥ì´ ìˆì„ ë•Œ ëœ ì¤‘ìš”í•œ ìš”ì†Œë³´ë‹¤ ìœ„ìª½ì— ìœ„ì¹˜í•˜ë„ë¡ í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œë„ ì†Œì…œë¡œê·¸ì¸ì„ ì¥ë ¤í•˜ëŠ” ë§ˆìŒìœ¼ë¡œ ìƒë‹¨ì— ìœ„ì¹˜ì‹œì¼°ìœ¼ë‹ˆ í˜¹ì‹œ ì—¬ëŸ¬ë¶„ì€ ë‹¤ë¥¸ ìƒê°ì´ ìˆìœ¼ì‹œë‹¤ë©´ ìœ„ì¹˜ë¥¼ ë°”ê¾¸ì…”ë„ ìƒê´€ì—†ìŠµë‹ˆë‹¤.

### ë„¤ì´ë²„ ë¡œê·¸ì¸ javascript êµ¬í˜„
ì•„ê¹Œ ë³´ì‹ ëŒ€ë¡œ ë„¤ì´ë²„ ì†Œì…œë¡œê·¸ì¸ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” javascript ì½”ë“œë„ ì•½ê°„ í•„ìš”í•©ë‹ˆë‹¤. ì´ë²ˆì— êµ¬í˜„í•  javascript ëŠ” ì„œë²„ì—ì„œ ë Œë”ë§í•  ë¶€ë¶„ì´ ì—†ê¸° ë•Œë¬¸ì— static ë””ë ‰í† ë¦¬ì— íŒŒì¼ì„ ë¶„ë¦¬í•©ë‹ˆë‹¤. ìš°ì„  `social_login_panel.html` íŒŒì¼ í•˜ë‹¨ì— `script` íƒœê·¸ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

```html
<!-- user/templates/user/partials/form_field.html -->

<!-- ìƒëµ -->

{% raw %}
<script src="{% static 'user/js/social_login.js' %}"></script>
{% endraw %}
```
ê·¸ë¦¬ê³  `user/static/user/js/social_login.js` íŒŒì¼ì„ í•˜ë‚˜ ìƒì„±í•˜ì‹œê³  ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.
```javascript

// user/static/user/js/social_login.js


function buildQuery(params) {
    return Object.keys(params).map(function (key) {return key + '=' + encodeURIComponent(params[key])}).join('&')
}
function buildUrl(baseUrl, queries) {
    return baseUrl + '?' + buildQuery(queries)
}

function naverLogin() { // ë„¤ì´ë²„ ë¡œê·¸ì¸
    params = {
        response_type: 'code',
        client_id:'nfenn0pzKTlihOzu_h8S',
        redirect_uri: location.origin + '/user/login/social/naver/callback/',
        state: document.querySelector('[name=csrfmiddlewaretoken]').value
    }
    url = buildUrl('https://nid.naver.com/oauth2.0/authorize', params)
    location.replace(url)
}
```
ì„¤ëª…ë“œë ¤ì•¼ í•  ë¶€ë¶„ì€ `naverLogin` í•¨ìˆ˜ì—ì„œ `params` ê°ì²´ì˜ ê° ê°’ë“¤ì…ë‹ˆë‹¤.  
ë¨¼ì € `reponse_type` ì€ í•­ìƒ `code` ì…ë‹ˆë‹¤. ë„¤ì´ë²„ sdk ì—ì„œëŠ” `token` ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆëŠ”ë° ì´ë ‡ê²Œ í•˜ë©´ ì–´ëŸ¬ë¶„ì˜ ì„œë²„ì—ì„œ ì¸ì¦í† í°ì„ ë°›ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë¸Œë¼ìš°ì €ì—ì„œ ì „ë‹¬í•˜ëŠ” ì¸ì¦í† í°ì„ ì‚¬ìš©í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë³´ì•ˆì— ì·¨ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¦‰ ì´ ë°©ì‹ìœ¼ë¡œ ì „ë‹¬ë°›ì€ ê²ƒë“¤ë¡œ ì‚¬ìš©ì ê°€ì…ì„ í•œë‹¤ë©´ ì•…ì˜ì ìœ¼ë¡œ ë‹¤ë¥¸ ì‚¬ëŒì˜ `access_token` ì„ ë„ìš©í•´ë„ í™•ì¸í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ì—†ìŠµë‹ˆë‹¤. ì—¬ëŸ¬ë¶„ì´ ì†Œì…œë¡œê·¸ì¸ëœ ì‚¬ìš©ìì˜ íšŒì›ì •ë³´ë¥¼ ì„œë²„ì— ì €ì¥í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì— ì í•©í•œ ë°©ì‹ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” **ë„¤ì´ë²„ ì†Œì…œë¡œê·¸ì¸ì„ í•˜ê³  íšŒì›ì •ë³´ë¥¼ ì´ìš©í•´ì„œ ì„œë²„ì— íšŒì›ì„ ê°€ì…ì‹œí‚¤ê³  íšŒì›ì •ë³´ë¥¼ ì €ì¥í•  ê²ƒì´ê¸° ë•Œë¬¸ì— `code` íƒ€ì…ìœ¼ë¡œ ì„¤ì •**í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.  
`client_id` ëŠ” ì•„ê¹Œ ì•±ë“±ë¡í•˜ê³  ë°œê¸‰ë°›ì€ `client_id` ì…ë‹ˆë‹¤. `client_id` ëŠ” `secret` ê³¼ëŠ” ë‹¬ë¦¬ ê³µê°œë˜ì–´ë„ ë˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤.  
`redirect_uri` ëŠ” ì•±ë“±ë¡í•  ë•Œ ì…ë ¥í•œ Callback URL ì¤‘ì˜ í•˜ë‚˜ë¥¼ ì…ë ¥í•˜ë©´ ë©ë‹ˆë‹¤. ê°œë°œë‹¨ê³„ì—ì„œëŠ” `hostname` ì´ `localhost` ì´ì§€ë§Œ ì‹¤ì œ ì„œë¹„ìŠ¤ì— ë°°í¬ë¥¼ í•˜ë©´ í•´ë‹¹ ë„ë©”ì¸ìœ¼ë¡œ ì„¤ì •ë˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.  
`state` ëŠ” ì•„ì£¼ ì¤‘ìš”í•œ ê°’ì…ë‹ˆë‹¤. **csrf ë“±ì˜ ê³µê²©ìœ¼ë¡œ ì‚¬ìš©ìê°€ í•´ë‹¹ ì„œë¹„ìŠ¤ë¥¼ ì ‘ì†í•˜ì§€ ì•Šê³  ì†Œì…œë¡œê·¸ì¸ì„ ì‹œë„í•˜ëŠ” ê²½ìš°ë¥¼ ì°¨ë‹¨**í•˜ê¸° ìœ„í•´ì„œ í•„ìš”í•œ ê°’ì…ë‹ˆë‹¤. ì„ì˜ì˜ ë¬¸ìì—´ì´ í•„ìš”í•œë° ì„œë²„ì—ì„œë„ ì˜¬ë°”ë¥¸ ê°’ì¸ì§€ ë¹„êµí•  ìˆ˜ ìˆë„ë¡ ë¡œê·¸ì¸ `csrfmiddlewaretoken` ì„ ì´ìš©í–ˆìŠµë‹ˆë‹¤. `state` ê°’ì„ ì„œë²„ì—ì„œ ì´ìš©í•˜ëŠ” ë°©ë²•ì€ ë·°ë¥¼ ê°œë°œí•  ë•Œ ì„¤ëª…í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.  

`naverLogin` í•¨ìˆ˜ëŠ” ê²°êµ­ ìƒì„±ëœ url ë¡œ í™”ë©´ì´ ì „í™˜í•˜ë„ë¡ í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì „í™˜ëœ í™”ë©´ì€ ë„¤ì´ë²„ì—ì„œ ì œê³µí•˜ëŠ” í™”ë©´ìœ¼ë¡œ ì—¬ëŸ¬ë¶„ì´ ì»¨íŠ¸ë¡¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë§Œ ì•±ì„¤ì • í™”ë©´ ëª‡ê°€ì§€ ì„¤ì •ë§Œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ìƒíƒœì—ì„œ ë„¤ì´ë²„ ì•„ì´ë””ë¡œ ë¡œê·¸ì¸ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í™”ë©´ì´ ë„¤ì´ë²„ì—ì„œ ì œê³µí•˜ëŠ” í™”ë©´ìœ¼ë¡œ ì „í™˜ë˜ê³  ì•„ì§ ë„¤ì´ë²„ì— ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ìƒíƒœì¼ ê²½ìš° ë¡œê·¸ì¸í™”ë©´ì´ ë‚˜íƒ€ë‚˜ê³  ë¡œê·¸ì¸ì„ í•˜ë©´ ì•± ê¶Œí•œì„¤ì •í•˜ëŠ” í™”ë©´ìœ¼ë¡œ ì „í™˜ë©ë‹ˆë‹¤.(ë¡œê·¸ì¸ì´ ë˜ì–´ ìˆì„ ë•ŒëŠ” ê³§ë°”ë¡œ ì•± ê¶Œí•œì„¤ì •í•˜ëŠ” í™”ë©´ìœ¼ë¡œ ì´ë™ë©ë‹ˆë‹¤.) 

![ë„¤ì´ë²„ ì†Œì…œë¡œê·¸ì¸ 02]({{ site.url }}/snapshots/naver_social_login_02.png)

í•„ìˆ˜ ì œê³µ í•­ëª©ì— ì•„ê¹Œ ì„¤ì •í•œ í•„ìˆ˜ê¶Œí•œìœ¼ë¡œ ì„¤ì •í•œ ì´ë¦„ê³¼ ì´ë©”ì¼ì´ ì„ íƒí•  ìˆ˜ ìˆê²Œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì´ í•­ëª©ë“¤ì„ ì œê³µí•˜ì§€ ì•Šê³  ì‹¶ì„ ê²½ìš°ì— ì„ íƒì„ í•´ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ì´ë¦„ê³¼ ì´ë©”ì¼ì„ ì´ìš©í•´ íšŒì›ê°€ì…ì„ êµ¬í˜„í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì–´ëŠ í•˜ë‚˜ë¼ë„ ì„ íƒì„ í•´ì œí•  ê²½ìš° ì´í›„ callback ìœ¼ë¡œ ì´ë™ëœ ë·°ì—ì„œ ë¡œê·¸ì¸ì„ í—ˆìš©í•˜ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤. ë™ì˜í•˜ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ `redirect_uri` ë¡œ ì„¤ì •í•œ ì£¼ì†Œë¡œ ì´ë™í•©ë‹ˆë‹¤. ë¬¼ë¡  ì•„ì§ ë·°ê°€ ì—†ìœ¼ë‹ˆ ì˜¤ë¥˜ê°€ ë‚  ê²ƒì…ë‹ˆë‹¤.

### ë„¤ì´ë²„ ë¡œê·¸ì¸ callback ë·° êµ¬í˜„
í˜„ì¬ëŠ” ë„¤ì´ë²„ì˜ ì†Œì…œë¡œê·¸ì¸ë§Œ ì œê³µí•˜ê³  ìˆì§€ë§Œ í–¥í›„ ì¹´ì¹´ì˜¤ë‚˜ í˜ì´ìŠ¤ë¶ ë“±ì˜ ì†Œì…œë¡œê·¸ì¸ë„ ê¸°ëŠ¥ì„ ì œê³µí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— callback ë·°ëŠ” í•˜ë‚˜ë§Œ ì œê³µí•˜ê³ , í”„ë¡œë°”ì´ë” ë³„ë¡œ ë¯¹ìŠ¤ì¸ì„ ì¶”ê°€í•˜ë„ë¡ í•˜ëŠ” ë°©ë²•ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤. í”„ë¡œë°”ì´ë” ë³„ë¡œ callback ë·°ë¥¼ ìƒì„±í•  ìˆ˜ë„ ìˆìœ¼ë‚˜ ì—¬ëŸ¬ë¶„ì˜ ì„ íƒì…ë‹ˆë‹¤. ~~ë¶„ë¦¬í•˜ëŠ” ê²Œ ì € ê°œì¸ì ìœ¼ë¡œ ì„ í˜¸í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.~~

`SocialLoginCallbackView` ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë·°ë¥¼ í•˜ë‚˜ ìƒì„±í•©ë‹ˆë‹¤. 
```python
# user/views.py

from django.conf import settings
from django.views.generic.base import TemplateView, View
from django.middleware.csrf import _compare_salted_tokens
from user.oauth.providers.naver import NaverLoginMixin

# ìƒëµ

class SocialLoginCallbackView(NaverLoginMixin, View):

    success_url = settings.LOGIN_REDIRECT_URL
    failure_url = settings.LOGIN_URL
    required_profiles = ['email', 'name']
    model = get_user_model()

    def get(self, request, *args, **kwargs):

        provider = kwargs.get('provider')

        if provider == 'naver': # í”„ë¡œë°”ì´ë”ê°€ naver ì¼ ê²½ìš°
            csrf_token = request.GET.get('state')
            code = request.GET.get('code')
            if not _compare_salted_tokens(csrf_token, request.COOKIES.get('csrftoken')): # state(csrf_token)ì´ ì˜ëª»ëœ ê²½ìš°
                messages.error(request, 'ì˜ëª»ëœ ê²½ë¡œë¡œ ë¡œê·¸ì¸í•˜ì…¨ìŠµë‹ˆë‹¤.', extra_tags='danger')
                return HttpResponseRedirect(self.failure_url)
            is_success, error = self.login_with_naver(csrf_token, code)
            if not is_success: # ë¡œê·¸ì¸ ì‹¤íŒ¨í•  ê²½ìš°
                messages.error(request, error, extra_tags='danger')
            return HttpResponseRedirect(self.success_url if is_success else self.failure_url)

        return HttpResponseRedirect(self.failure_url)

    def set_session(self, **kwargs):
        for key, value in kwargs.items():
            self.request.session[key] = value
```

`SocialLoginCallbackView` ë·°ëŠ” í™”ë©´ì´ í•„ìš”ì—†ê³  **ì˜¤ì§ ì„œë²„ë‹¨ì—ì„œ ë„¤ì´ë²„ ì¸ì¦í† í°ì„ ë°›ê³  ì¸ì¦ì²˜ë¦¬**ë¥¼ í•˜ëŠ” ê¸°ëŠ¥ë§Œ í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ ê¸°ë³¸ ì œë„¤ë¦­ë·°ë¥¼ ìƒì†ë°›ì•˜ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ì— ì„¤ì •í•  ê²½ìš° `settings.LOGIN_REDIRECT_URL` ë¡œ ì´ë™í•˜ê³  ë¡œê·¸ì¸ì— ì‹¤íŒ¨í•  ê²½ìš° `settings.LOGIN_URL` ì— ì´ë™í•˜ë„ë¡ ì„¤ì •í–ˆìŠµë‹ˆë‹¤. ë§Œì¼ ë³€ê²½í•˜ê³  ì‹¶ìœ¼ì‹œë‹¤ë©´ `success_url`, `failure_url` í´ë˜ìŠ¤ë³€ìˆ˜ë¥¼ ìˆ˜ì •í•˜ì‹œë©´ ë©ë‹ˆë‹¤.(í•´ë‹¹ ê°’ë“¤ì€ ì„¤ì •íŒŒì¼ì— ì„¤ì •í•˜ëŠ” ê²ƒì´ ì¬ì‚¬ìš©í•˜ëŠ” ë° í¸ë¦¬í•©ë‹ˆë‹¤.) 

`SocialLoginCallbackView` ëŠ” ë„¤ì´ë²„ ì†Œì…œë¡œê·¸ì¸ ê¸°ëŠ¥ì„ êµ¬í˜„í•œ `NaverLoginMixin` ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. [`NaverLoginMixin`]({{ page.url}}#ë„¤ì´ë²„-ë¡œê·¸ì¸-ë¯¹ìŠ¤ì¸-êµ¬í˜„) ëŠ” ì¡°ê¸ˆ ë’¤ì— ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤. 

ë¨¼ì € ì‚´í´ë´ì•¼ í•  ë¶€ë¶„ì€ `provider = kwargs.get('provider')` ë¶€ë¶„ì¸ë° `SocialLoginCallbackView` ì—ì„œëŠ” url ë¼ìš°í„°ë¡œë¶€í„° í”„ë¡œë°”ì´ë” ì´ë¦„ì„ ì¸ìë¡œ ì „ë‹¬ë°›ìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ í•˜ë‚˜ì˜ callback ë·°ì—ì„œ ì—¬ëŸ¬ ê°œì˜ í”„ë¡œë°”ì´ë” ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í˜„ì¬ëŠ” í•˜ë‚˜ì˜ í”„ë¡œë°”ì´ë” ë§Œ ì œê³µí•˜ê¸° ë•Œë¬¸ì— ì´ë ‡ê²Œ í–ˆì§€ë§Œ 2ê°œ ì´ìƒì˜ í”„ë¡œë°”ì´ë” ë§Œ ì œê³µí•˜ë”ë¼ë„ ë·°í´ë˜ìŠ¤ë¥¼ ë¶„ë¦¬í•˜ëŠ” ê²ƒë„ ë” íš¨ìœ¨ì ì¼ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

**`_compare_salted_tokens` í•¨ìˆ˜ë¥¼ í†µí•´ ìš”ì²­ëœ urlì˜ query ê°’ì˜ `state` ê°’ê³¼ ì¿ í‚¤ì˜ `csrftoken` ì„ ë¹„êµ**í•©ë‹ˆë‹¤. state ê°’ì€ `naverLogin()` í•¨ìˆ˜ì—ì„œ ì „ë‹¬í•œ `state` ê°’ì…ë‹ˆë‹¤. ë§Œì¼ ì •ìƒì ì¸ ë¡œê·¸ì¸í˜ì´ì§€ì—ì„œ ë„¤ì´ë²„ ì†Œì…œë¡œê·¸ì¸ ë²„íŠ¼ì„ ëˆ„ë¥¸ ê±°ë¼ë©´ `state` ê°’ì´ ì¿ í‚¤ì˜ `csrftoken`ê³¼ ë™ì¼í•œ ê°’ì´ì–´ì•¼ í•©ë‹ˆë‹¤. `_compare_salted_tokens` í•¨ìˆ˜ë¡œ ë¹„êµí•˜ë©´ ë™ì¼í•œ ì§€ ì•„ë‹Œ ì§€ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. `state` ê°’ì´ ì •ìƒì ì¸ ê°’ì´ë¼ë©´ `NaverLoginMixin` ì— ì •ì˜í•œ `login_with_naver` ë©”ì†Œë“œë¥¼ í†µí•´ì„œ ë¡œê·¸ì¸ì„ ì‹œë„í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ì´ ì •ìƒì ìœ¼ë¡œ ë˜ì—ˆë‹¤ë©´ `success_url` ë¡œ ì´ë™í•˜ë„ë¡ í•˜ê³  ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆë‹¤ë©´ `failure_url` ë¡œ ì´ë™í•©ë‹ˆë‹¤.

### ë„¤ì´ë²„ ë¡œê·¸ì¸ ë¯¹ìŠ¤ì¸ êµ¬í˜„

`NaverLoginMixin` ëŠ” ì¥ê³ ì—ì„œ ì œê³µí•˜ëŠ” í´ë˜ìŠ¤ê°€ ì•„ë‹ˆë¼ ì—¬ëŸ¬ë¶„ì´ êµ¬í˜„í•  í´ë˜ìŠ¤ì…ë‹ˆë‹¤. user ì•±ì— `oauth` ë¼ëŠ” íŒ¨í‚¤ì§€ë¥¼ ìƒì„±í•˜ê³  ê·¸ ì•ˆì— `providers` ë¼ëŠ” íŒ¨í‚¤ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. `providers` íŒ¨í‚¤ì§€ì— `naver.py` ë¼ëŠ” íŒŒì¼ì„ ìƒì„± í›„ ì•„ë˜ì™€ ê°™ì´ ì½”ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

> ì¼ë°˜ë””ë ‰í† ë¦¬ì™€ ë‹¬ë¦¬ íŒ¨í‚¤ì§€ëŠ” ë‚´ë¶€ì— `__init__.py` ëª¨ë“ˆ(íŒŒì¼)ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

```python
# user/oauth/providers/naver.py

from django.conf import settings
from django.contrib.auth import login

class NaverLoginMixin:
    naver_client = NaverClient()

    def login_with_naver(self, state, code):
        
        # ì¸ì¦í† ê·¼ ë°œê¸‰
        is_success, token_infos = self.naver_client.get_access_token(state, code)

        if not is_success:
            return False, '{} [{}]'.format(token_infos.get('error_desc'), token_infos.get('error'))

        access_token = token_infos.get('access_token')
        refresh_token = token_infos.get('refresh_token')
        expires_in = token_infos.get('expires_in')
        token_type = token_infos.get('token_type')

        # ë„¤ì´ë²„ í”„ë¡œí•„ ì–»ê¸°
        is_success, profiles = self.get_naver_profile(access_token, token_type)
        if not is_success:
            return False, profiles

        # ì‚¬ìš©ì ìƒì„± ë˜ëŠ” ì—…ë°ì´íŠ¸
        user, created = self.model.objects.get_or_create(email=profiles.get('email'))
        if created: # ì‚¬ìš©ì ìƒì„±í•  ê²½ìš°
            user.set_password(None)
        user.name = profiles.get('name')
        user.is_active = True
        user.save()

        # ë¡œê·¸ì¸
        login(self.request, user, 'user.oauth.backends.NaverBackend')

        # ì„¸ì…˜ë°ì´í„° ì¶”ê°€
        self.set_session(access_token=access_token, refresh_token=refresh_token, expires_in=expires_in, token_type=token_type)

        return True, user

    def get_naver_profile(self, access_token, token_type):
        is_success, profiles = self.naver_client.get_profile(access_token, token_type)

        if not is_success:
            return False, profiles

        for profile in self.required_profiles:
            if profile not in profiles:
                return False, '{}ì€ í•„ìˆ˜ì •ë³´ì…ë‹ˆë‹¤. ì •ë³´ì œê³µì— ë™ì˜í•´ì£¼ì„¸ìš”.'.format(profile)

        return True, profiles
```

`NaverLoginMixin` ì—ì„œ ë„¤ì´ë²„ì˜ apië¥¼ êµ¬í˜„í•œ ë„¤ì´ë²„ í´ë¼ì´ì–¸íŠ¸ë¥¼ `naver_client` í´ë˜ìŠ¤ë³€ìˆ˜ë¡œ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ë„¤ì´ë²„ì˜ ì¸ì¦í† í° ë°œê¸‰ê³¼ í”„ë¡œí•„ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë‘ ê°€ì§€ì˜ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. [ë„¤ì´ë²„ í´ë¼ì´ì–¸íŠ¸]({{ page.url }}#ë„¤ì´ë²„-í´ë¼ì´ì–¸íŠ¸-êµ¬í˜„)ëŠ” ë‚˜ì¤‘ì— ì„¤ëª…í•˜ê¸°ë¡œ í•˜ê³  `login_with_naver` ë©”ì†Œë“œë¥¼ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤. `login_with_naver` ë©”ì†Œë“œëŠ” `naver_client`ë¡œë¶€í„° `token_infos` ê°ì²´ë¥¼ ì „ë‹¬ë°›ëŠ”ë° `token_infos` ê°ì²´ëŠ” ì•„ë˜ì™€ ê°™ì€ í‚¤ë¥¼ ê°–ëŠ” ë”•ì…”ë„ˆë¦¬ ê°ì²´ì…ë‹ˆë‹¤.

1. error - ì—ëŸ¬ì½”ë“œ
2. error_description - ì—ëŸ¬ë©”ì‹œì§€
3. access_token - ì¸ì¦í† í°
4. refresh_token - ì¸ì¦í† í° ì¬ë°œê¸‰í† í°
5. expires_in - ì¸ì¦í† í° ë§Œë£Œê¸°í•œ(ì´ˆ)
6. token_type - ì¸ì¦í† í° ì‚¬ìš©í•˜ëŠ” api í˜¸ì¶œì‹œ ì¸ì¦ë°©ì‹(Authorization í—¤ë” íƒ€ì…)

ë§Œì¼ ì¸ì¦í† í°ì„ ë°›ì•„ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆë‹¤ë©´ ì—ëŸ¬ë©”ì‹œì§€ì™€ í•¨ê»˜ í•¨ìˆ˜ë¥¼ ë°”ë¡œ ì¢…ë£Œí•©ë‹ˆë‹¤. 

ì¸ì¦í† í°ì´ ì •ìƒì ìœ¼ë¡œ ë°œê¸‰ë˜ì—ˆë‹¤ë©´ íšŒì›ê°€ì…ì„ ìœ„í•´ ì´ë©”ì¼ê³¼ ì‚¬ìš©ìì˜ ì´ë¦„ì„ ë°›ì•„ì•¼ í•˜ëŠ”ë°, ë„¤ì´ë²„ì—ì„œ profile apië„ ì œê³µí•´ì£¼ê¸° ë•Œë¬¸ì— ì´ê²ƒì„ ì´ìš©í•´ì„œ ë°›ì•„ì˜¤ë©´ ë©ë‹ˆë‹¤. **`get_naver_profile` ë©”ì†Œë“œëŠ” apië¥¼ í†µí•´ ë°›ì•„ ì˜¨ í”„ë¡œí•„ ì •ë³´ë¥¼ ê²€ì¦í•˜ëŠ” ì—­í• **ì„ í•©ë‹ˆë‹¤. í”„ë¡œí•„ ì •ë³´ëŠ” ì‚¬ìš©ìê°€ ì œê³µí•­ëª©ì— ì„ íƒí•œ ê°’ë“¤ê³¼ ì‚¬ìš©ìì˜ id ê°’ë§Œ ì „ë‹¬ë˜ëŠ”ë° ë§Œì¼ **ì´ë©”ì¼ì´ë‚˜ ì´ë¦„ì„ ì„ íƒí•˜ì§€ ì•Šì€ ê²½ìš° ì—ëŸ¬ë©”ì‹œì§€ë¥¼ ë°˜í™˜**í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.

í”„ë¡œí•„ì •ë³´ê¹Œì§€ ì •ìƒì ìœ¼ë¡œ ë°›ì•„ì˜¤ë©´ ì‚¬ìš©ì ëª¨ë¸ì—ì„œ `get_or_create` ë©”ì†Œë“œë¥¼ í†µí•´ ë™ì¼í•œ ì´ë©”ì¼ì˜ ì‚¬ìš©ìê°€ ìˆëŠ” ì§€ í™•ì¸ í›„ ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±í•©ë‹ˆë‹¤. ì†Œì…œë¡œê·¸ì¸ì€ ê°€ì…ê³¼ ë¡œê·¸ì¸ì„ ë™ì‹œì— ì œê³µí•˜ëŠ” ê²ƒì´ ë” ì¢‹ìŠµë‹ˆë‹¤. ì´ë¯¸ **ê°€ì…ë˜ì–´ ìˆëŠ” ì‚¬ìš©ìë¼ë©´ íšŒì›ì •ë³´(ì´ë¦„)ë§Œ ìˆ˜ì •**í•˜ë©´ ë˜ê³ , **ê°€ì…ë˜ì–´ ìˆì§€ ì•Šì€ ì¼€ì´ìŠ¤ë¼ë©´ ìƒˆë¡œ íšŒì›ì •ë³´ë¥¼ ìƒì„±í•´ì„œ ê°€ì…**ì‹œì¼œ ì¤ë‹ˆë‹¤. ì†Œì…œë¡œê·¸ì¸ì€ ë¡œì»¬ ë¹„ë°€ë²ˆí˜¸ê°€ í•„ìš”ì—†ê¸° ë•Œë¬¸ì— ìƒˆë¡œ ì‚¬ìš©ì ë°ì´í„°ê°€ ì¶”ê°€ë˜ëŠ” ê²½ìš°ë¼ë©´ `set_password(None)` ë©”ì†Œë“œë¥¼ í†µí•´ ëœë¤í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìƒì„±í•´ì„œ ì €ì¥í•©ë‹ˆë‹¤. ì´ë¯¸ ì†Œì…œë¡œê·¸ì¸ì„ í†µí•´ì„œ ì´ë©”ì¼ì— ëŒ€í•œ ì¸ì¦ë„ ë˜ì—ˆìœ¼ë‹ˆ `is_active` ê°’ë„ í™œì„±í™” ì‹œì¼œì£¼ê³  ì €ì¥ì„ í•˜ë©´ ê°€ì…ì´ ì™„ë£Œì…ë‹ˆë‹¤. ë§Œì¼ **ì´ë¯¸ ê°€ì…ë˜ì–´ ìˆë˜ ì‚¬ìš©ìë¼ë©´ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¡œë„ ë¡œê·¸ì¸ì´ ê°€ëŠ¥í•˜ê³  ë„¤ì´ë²„ ì†Œì…œë¡œê·¸ì¸ìœ¼ë¡œë„ ë¡œê·¸ì¸ì´ ê°€ëŠ¥**í•©ë‹ˆë‹¤.

ê°€ì…ëœ ì´í›„ì— ë¡œê·¸ì¸ì²˜ë¦¬ê¹Œì§€ í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ì€ `auth` í”„ë ˆì„ì›Œí¬ì˜ `login` í•¨ìˆ˜ë¥¼ ì´ìš©í•©ë‹ˆë‹¤. `login` í•¨ìˆ˜ëŠ” ì‚¬ìš©ì ë°ì´í„°ì™€ ë¡œê·¸ì¸ì²˜ë¦¬ë¥¼ í•´ì¤„ ì¸ì¦ë°±ì—”ë“œì˜ ê²½ë¡œê°€ í•„ìš”í•©ë‹ˆë‹¤. ê¸°ë³¸ ì¸ì¦ëª¨ë“ˆì¸ `'django.contrib.auth.backends.ModelBackend'` ëŠ” `username(email)` ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì´ìš©í•´ì„œ ì¸ì¦ì²˜ë¦¬ë¥¼ í•˜ëŠ”ë° ì†Œì…œë¡œê·¸ì¸ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì „ë‹¬ë°›ì„ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤. ì–´ì©” ìˆ˜ ì—†ì´ ì†Œì…œë¡œê·¸ì¸ì„ ìœ„í•œ ì¸ì¦ë°±ì—”ë“œë¥¼ ì¶”ê°€ë¡œ êµ¬í˜„í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤. [ì¸ì¦ë°±ì—”ë“œ]({{ page.url }}#ì¸ì¦ë°±ì—”ë“œ-êµ¬í˜„)ì˜ êµ¬í˜„ì€ ì¡°ê¸ˆ ë’¤ì— ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤. 

ì†Œì…œë¡œê·¸ì¸ì˜ ë§ˆì§€ë§‰ì€ **ì„¸ì…˜ì •ë³´ì— ì¸ì¦í† í°ì •ë³´ë¥¼ ì¶”ê°€**í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. í˜„ì¬ëŠ” ì¸ì¦í† í°ì´ í•„ìš”ì—†ì§€ë§Œ ë„¤ì´ë²„ apië¥¼ ì´ìš©í•œ ê¸°ëŠ¥ì„ ì œê³µí•  ê²½ìš°ë„ ìˆìŠµë‹ˆë‹¤. ì´ ë•Œ ì‚¬ìš©ìì˜ ì¸ì¦í† í°ì´ ìˆì–´ì•¼ë§Œ ì‚¬ìš©ìì˜ ê¶Œí•œìœ¼ë¡œ ë„¤ì´ë²„ ì„œë¹„ìŠ¤ api ê¸°ëŠ¥ë“¤ì„ ì œê³µí•  ìˆ˜ ìˆëŠ”ë° ë§¤ë²ˆ ì¬ë¡œê·¸ì¸ì„ í•  ìˆ˜ ì—†ìœ¼ë‹ˆ ì¸ì¦í† í°ê³¼ ê·¸ ì™¸ ì •ë³´ë“¤ì„ ì„¸ì…˜ì— ì €ì¥í•©ë‹ˆë‹¤. ì¸ì¦í† í° ì¬ë°œê¸‰í† í°(refresh_token)ë„ í•¨ê»˜ ì €ì¥ì„ í•´ì•¼ ì¸ì¦í† í°ì´ ë§Œë£Œê°€ ë˜ë”ë¼ë„ ì¬ë°œê¸‰í† í°ìœ¼ë¡œ ë‹¤ì‹œ ì¸ì¦í† í°ì„ ê°±ì‹ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì¼ ì¬ë°œê¸‰í† í°ë„ ë§Œë£Œê°€ ë˜ì—ˆê±°ë‚˜ ë¬¸ì œê°€ ìˆì–´ì„œ ì¸ì¦í† í°ì„ ê°±ì‹ í•  ìˆ˜ ì—†ë‹¤ë©´ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ í•´ì£¼ë©´ ë©ë‹ˆë‹¤.

### ë„¤ì´ë²„ í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„
ë„¤ì´ë²„ api ë¥¼ í˜¸ì¶œí•˜ëŠ” ëª¨ë“ˆì´ `NaverLoginMixin` ì—ì„œ í•„ìš”í•©ë‹ˆë‹¤. ë„¤ì´ë²„ api ëŠ” ì¸ì¦ê³¼ ê´€ë ¨ëœ ë¶€ë¶„ê³¼ ì„œë¹„ìŠ¤ apië¥¼ í†µì¹­í•˜ì§€ë§Œ í˜„ì¬ ì—¬ëŸ¬ë¶„ì€ ì¸ì¦ê³¼ ê´€ë ¨ëœ api ë§Œ êµ¬í˜„í•  ê²ƒì…ë‹ˆë‹¤. ê·¸ë˜ì„œ ë„¤ì´ë²„ ë¡œê·¸ì¸ ë¯¹ìŠ¤ì¸ê³¼ ë™ì¼í•œ íŒ¨í‚¤ì§€ì— êµ¬í˜„í•´ë„ ê´œì°®ì„ ë“¯ í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ë‚˜ì¤‘ì— ë„¤ì´ë²„ ì„œë¹„ìŠ¤ apië„ êµ¬í˜„í•˜ê²Œ ëœë‹¤ë©´ ì´ê²ƒì„ ì™¸ë¶€ë¡œ ë¶„ë¦¬ì‹œí‚¤ëŠ” ê²ƒì´ ë°”ëŒì§í•©ë‹ˆë‹¤. 

ë„¤ì´ë²„ì˜ apië¥¼ í˜¸ì¶œí•  ë•Œ `requests` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ í˜¸ì¶œí•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤. `requests` ëŠ” íŒŒì´ì¬ì˜ í‘œì¤€ http í´ë¼ì´ì–¸íŠ¸ë³´ë‹¤ ì‚¬ìš©í•˜ê¸° ê°„í¸í•˜ê³ , ë¬´ì—‡ë³´ë‹¤ ì§ê´€ì ì…ë‹ˆë‹¤. `requests` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¨¼ì € ì„¤ì¹˜í•˜ì„¸ìš”.
```bash
(test-venv-36) $ pip install requests
```

`NaverLoginMixin` ì´ ì •ì˜ëœ `oauth/providers/naver.py` ì— `NaverClient` ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•˜ê³  ì•„ë˜ì™€ ê°™ì´ ì •ì˜í•©ë‹ˆë‹¤.
```python
# user/oauth/providers/naver.py

import requests


class NaverClient:
    client_id = settings.NAVER_CLIENT_ID
    secret_key = settings.NAVER_SECRET_KEY
    grant_type = 'authorization_code'

    auth_url = 'https://nid.naver.com/oauth2.0/token'
    profile_url = 'https://openapi.naver.com/v1/nid/me'

    __instance = None

    def __new__(cls, *args, **kwargs):
        if not isinstance(cls.__instance, cls):
            cls.__instance = super().__new__(cls, *args, **kwargs)
        return cls.__instance

    def get_access_token(self, state, code):
        res = requests.get(self.auth_url, params={'client_id': self.client_id, 'client_secret': self.secret_key,
                                                  'grant_type': self.grant_type, 'state': state, 'code': code})

        return res.ok, res.json()

    def get_profile(self, access_token, token_type='Bearer'):
        res = requests.get(self.profile_url, headers={'Authorization': '{} {}'.format(token_type, access_token)}).json()

        if res.get('resultcode') != '00':
            return False, res.get('message')
        else:
            return True, res.get('response')
```
[ë„¤ì´ë²„ ì†Œì…œë¡œê·¸ì¸ íŠœí† ë¦¬ì–¼](https://developers.naver.com/docs/login/web/) ë¬¸ì„œë¥¼ ì°¸ê³ í•´ì„œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. íŠ¹ë³„íˆ ì–´ë ¤ìš´ ë‚´ìš©ì€ ì—†ê³  ê°„ë‹¨íˆ requests ëª¨ë“ˆì˜ ì‚¬ìš©ë²•ì„ ì•Œë ¤ë“œë¦¬ë©´ `get`, `post`, `put`, `delete` ë“±ì˜ í•¨ìˆ˜ë“¤ì´ êµ¬í˜„ë˜ì–´ ìˆê³ , ê°ê°ì˜ í•¨ìˆ˜ëŠ” í•¨ìˆ˜ëª…ê³¼ ë™ì¼í•œ http ë©”ì†Œë“œë¡œ ìš”ì²­ì„ í•©ë‹ˆë‹¤. ì²«ë²ˆì§¸ ìœ„ì¹˜ ì¸ìëŠ” url ì´ê³  ê·¸ ì™¸ íŒŒë¼ë¯¸í„°ëŠ” keyword ì¸ìë¡œ ì „ë‹¬í•˜ë©´ ë©ë‹ˆë‹¤. `get_profile` ë©”ì†Œë“œì—ì„œ `headers` ë¼ëŠ” íŒŒë¼ë¯¸í„°ê°€ ì‚¬ìš©ë˜ëŠ”ë° http í—¤ë”ì˜ ê°’ì„ ë”•ì…”ë„ˆë¦¬ í˜•íƒœë¡œ ì „ë‹¬í•˜ë©´ ë©ë‹ˆë‹¤. `Authorization` í—¤ë”ë¥¼ `token_type(bearer)` ì™€ ì¸ì¦í† í°ì„ ì¡°í•©í•œ ê°’ìœ¼ë¡œ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ê° í•¨ìˆ˜ ë°˜í™˜ë°ì´í„°ëŠ” json ë©”ì†Œë“œë¥¼ í†µí•´ ë³¸ë¬¸ì˜ ë‚´ìš©ì„ ë”•ì…”ë„ˆë¦¬ í˜•íƒœë¡œ ë°˜í™˜í•´ ì¤„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë¬¼ë¡  ë³¸ë¬¸ì´ json íƒ€ì…ì´ ì•„ë‹ ê²½ìš° ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.

ëˆˆì¹˜ì±„ì…¨ê² ì§€ë§Œ ì—¬ê¸°ì„œ ì•½ê°„ ì¬ë¯¸ìˆëŠ” í”„ë¡œê·¸ë˜ë°(ë””ìì¸) íŒ¨í„´ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. **`singleton` ì´ë¼ëŠ” íŒ¨í„´ì¸ë° ì²«ë²ˆì§¸ ìƒì„±ì í˜¸ì¶œ ë•Œë§Œ ê°ì²´ë§Œ ìƒì„±ì‹œí‚¤ê³  ì´í›„ ìƒì„±ì í˜¸ì¶œë¶€í„°ëŠ” ë¨¼ì € ìƒì„±ëœ ê°ì²´ë¥¼ ê³µìœ **í•˜ê²Œ í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. `NaverClient` í´ë˜ìŠ¤ë¥¼ `NaverLoginMixin` ë¿ë§Œ ì•„ë‹ˆë¼ ë‹¤ë¥¸ í´ë˜ìŠ¤ì—ì„œë„ ê³µìœ í•˜ë©° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `NaverClient` ê°ì²´ëŠ” ì¸ìŠ¤í„´ìŠ¤ë³€ìˆ˜ê°€ ì—†ê¸° ë•Œë¬¸ì— í•˜ë‚˜ì˜ ê°ì²´ë¥¼ ì„œë¡œ ê³µìœ í•˜ë”ë¼ë„ ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ì¸ìŠ¤í„´ìŠ¤ë³€ìˆ˜ê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë‚˜ ì—¬ëŸ¬ í´ë˜ìŠ¤ì—ì„œ ìœ í‹¸ë¦¬í‹°ì²˜ëŸ¼ ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ì˜ ê²½ìš° ì‹±ê¸€í„´ íŒ¨í„´ì„ ë§ì´ ì‚¬ìš©í•©ë‹ˆë‹¤. ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ë¹„ìš©ì´ ì¤„ì–´ ì„œë²„ì˜ ê°€ìš©ì„±ì„ ë†’ì´ëŠ” ì¢‹ì€ íŒ¨í„´ì´ë‹ˆ êµ¬í˜„ë°©ë²•ì„ ì•Œì•„ë‘ì„¸ìš”. íŒŒì´ì¬ì—ì„œ ì—¬ëŸ¬ê°€ì§€ ë°©ë²•ì´ ìˆìœ¼ë‚˜ ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ìœ¼ë¡œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

> ì¼ë°˜ì ìœ¼ë¡œ ì‹±ê¸€í„´ì€ ìƒì„±ìê°€ ì•„ë‹ˆë¼ ëª…ì‹œì ìœ¼ë¡œ `getInstance` ë¼ëŠ” static ë©”ì†Œë“œë¥¼ ì œê³µí•´ì„œ ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. `getInstance` ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ìƒì„±ìë¥¼ ì‚¬ìš©í•´ ê°ì²´ë¥¼ ìƒì„±í•˜ë©´ ì—ëŸ¬ë¥¼ ë°œìƒì‹œì¼œ ì‹±ê¸€í„´ìœ¼ë¡œ êµ¬í˜„ë˜ì—ˆìŒì„ ê°œë°œìì—ê²Œ ì•Œë ¤ì£¼ëŠ” ê²ƒì´ì£ . ì‹±ê¸€í„´ ê°ì²´ì— ì¸ìŠ¤í„´ìŠ¤ë³€ìˆ˜ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ í´ë˜ìŠ¤ë³€ìˆ˜ë¥¼ ë³€ê²½í•˜ë©´ ë²Œë°›ìŠµë‹ˆë‹¤. ã… ã… 

### ì¸ì¦ë°±ì—”ë“œ êµ¬í˜„

`NaverLoginMixin` ì—ì„œ ë¡œê·¸ì¸í•  ë•Œ ì¸ì¦ë°±ì—”ë“œë¥¼ `'user.oauth.backends.NaverBackend'` ë¡œ  ì „ë‹¬í–ˆìŠµë‹ˆë‹¤. ì¸ì¦ë°±ì—”ë“œì˜ ê²½ë¡œëŒ€ë¡œ `oauth` íŒ¨í‚¤ì§€ì— `backends.py` íŒŒì¼ì„ ì¶”ê°€í•˜ê³  ì•„ë˜ì˜ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•´ì¤ë‹ˆë‹¤.
```python

# user/oauth/backends.py

from django.contrib.auth import get_user_model
from django.contrib.auth.backends import ModelBackend
from django.contrib.auth.models import AnonymousUser

UserModel = get_user_model()


class NaverBackend(ModelBackend):
    def authenticate(self, request, username=None,**kwargs):
        if username is None:
            username = kwargs.get(UserModel.USERNAME_FIELD)
        try:
            user = UserModel._default_manager.get_by_natural_key(username)
        except UserModel.DoesNotExist:
            pass
        else:
            if self.user_can_authenticate(user):
                return user

```

`NaverBackend` ë°±ì—”ë“œëŠ” ê¸°ë³¸ì¸ì¦ë°±ì—”ë“œ(`ModelBackend`) ë¥¼ ìƒì†ë°›ì•„ ëŒ€ë¶€ë¶„ì˜ ê¸°ëŠ¥ë“¤ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. **`authenticate` ë©”ì†Œë“œì—ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë¹„êµí•˜ì—¬ ì¸ì¦í•˜ëŠ” ë¶€ë¶„ì´ ìˆëŠ”ë° ì´ ë¶€ë¶„ì„ ì‚­ì œí•˜ê³  ì†Œì…œë¡œê·¸ì¸ìœ¼ë¡œ `email` ë§Œ ë¹„êµ**í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤. ì €ëŠ” ì˜ˆì „ì— `naverid` ë„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ê³  `email` ê³¼ `naverid` ë„ ê°™ì´ ë¹„êµí•˜ë„ë¡ êµ¬í˜„í•œ ì ì´ ìˆëŠ”ë° naverid ê°€ ì„œë¹„ìŠ¤ì— í•„ìš”í•˜ë‹¤ë©´ ì €ì¥í•˜ëŠ” ê²ƒì´ ë§ìœ¼ë‚˜ ë¶ˆí•„ìš”í•˜ë‹¤ë©´ êµ³ì´ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤. ë§Œì¼ `email`ì´ ì‚¬ìš©ì í…Œì´ë¸”ì— ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ `None` ì„ ë°˜í™˜í•´ì£¼ë©´ ë©ë‹ˆë‹¤. í•¨ìˆ˜ì—ì„œ ì•„ë¬´ê²ƒë„ ë°˜í™˜í•˜ì§€ ì•Šìœ¼ë©´ `None` ì„ ë¦¬í„´í•˜ë¯€ë¡œ ì‚¬ìš©ì ë°ì´í„° ê²€ìƒ‰ì— ì‹¤íŒ¨í•  ê²½ìš° ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•Šë„ë¡(`pass`) í–ˆìŠµë‹ˆë‹¤.

`user_can_authenticate` ë©”ì†Œë“œëŠ” ì‚¬ìš©ì ë°ì´í„°ì˜ `is_active` ê°€ `True` ì¸ì§€ í™•ì¸í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ë¹„ë°€ë²ˆí˜¸ì™€ ê´€ê³„ê°€ ì—†ìœ¼ë‹ˆ ì´ê²ƒì„ í™•ì¸í•˜ëŠ” ê²ƒìœ¼ë¡œ ì¸ì¦ë°±ì—”ë“œì˜ ì¸ì¦í…ŒìŠ¤íŠ¸ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.

ì†Œì…œë¡œê·¸ì¸ì€ ì´ë¯¸ í”„ë¡œë°”ì´ë”ì—ê²Œ ì¸ì¦ì„ ìœ„ì„í–ˆê¸° ë•Œë¬¸ì— ì¸ì¦ë°±ì—”ë“œì—ì„œ ì¶”ê°€ë¡œ ì¸ì¦í•  ê²ƒì´ ë³„ë¡œ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë§Œ ì‚¬ìš©ì ëª¨ë¸ì˜ ì •ì˜ê°€ ì´ì „ ì˜ˆì œì™€ ê°™ì§€ ì•Šê³  ë¬´ì–¸ê°€ ì¶”ê°€ë¡œ ì¸ì¦í•´ì•¼ í•  í•„ë“œë“¤ì´ ìˆì„ ê²½ìš°ì—ë§Œ í•´ë‹¹ í•„ë“œë¥¼ ì´ìš©í•´ì„œ ì¶”ê°€ ì¸ì¦ì„ í•˜ë©´ ë©ë‹ˆë‹¤.

### next query íŒŒë¼ë¯¸í„° ì²˜ë¦¬

ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ ê²Œì‹œê¸€ ì‘ì„± í™”ë©´ ì ‘ê·¼ì‹œ ìë™ìœ¼ë¡œ ë¡œê·¸ì¸í˜ì´ì§€ë¡œ ì´ë™í•˜ê³  url ì˜ ì¿¼ë¦¬ì— next query íŒŒë¼ë¯¸í„°ê°€ ì¶”ê°€ë©ë‹ˆë‹¤.

![ë„¤ì´ë²„ ì†Œì…œë¡œê·¸ì¸ 03]({{ site.url }}/snapshots/naver_social_login_03.png)

í˜„ì¬ ì†Œì…œë¡œê·¸ì¸ì„ ì„±ê³µí•  ê²½ìš° ë¬´ì¡°ê±´ settings.LOGIN_REDIRECT_URL ë¡œ ì´ë™í•˜ëŠ”ë° next query íŒŒë¼ë¯¸í„°ê°€ ìˆëŠ” ê²½ìš° ì†Œì…œë¡œê·¸ì¸ ì´í›„ í•´ë‹¹ urlë¡œ ì´ë™í•˜ë„ë¡ ìˆ˜ì •í•˜ê² ìŠµë‹ˆë‹¤.

ìš°ì„  javascript ì˜ redirect_uri ë¥¼ í†µí•´ next query íŒŒë¼ë¯¸í„°ë¥¼ ì „ë‹¬í•˜ê² ìŠµë‹ˆë‹¤.
```javascript
// user/static/user/js/social_login.js

function buildQuery(params) {
    return Object.keys(params).map(function (key) {return key + '=' + encodeURIComponent(params[key])}).join('&')
}
function buildUrl(baseUrl, queries) {
    return baseUrl + '?' + buildQuery(queries)
}

function naverLogin() {
    params = {
        response_type: 'code',
        client_id:'nfenn0pzKTlihOzu_h8S',
        redirect_uri: location.origin + '/user/login/social/naver/callback/' + location.search,
        state: document.querySelector('[name=csrfmiddlewaretoken]').value
    }
    url = buildUrl('https://nid.naver.com/oauth2.0/authorize', params)
    location.replace(url)
}
```
query íŒŒë¼ë¯¸í„°ê°€ ìˆì„ ê²½ìš° redirect_uri ì—ë„ ê·¸ëŒ€ë¡œ ì¶”ê°€í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤. ë‹¤ìŒìœ¼ë¡œëŠ” callback view ì—ì„œ next query íŒŒë¼ë¯¸í„°ë¥¼ ì½ê³  ì†Œì…œë¡œê·¸ì¸ì´ ì„±ê³µí–ˆì„ ê²½ìš° í•´ë‹¹ urlë¡œ ì´ë™í•˜ë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤.

```python
# user/views.py

# ìƒëµ

class SocialLoginCallbackView(NaverLoginMixin, View):

    success_url = settings.LOGIN_REDIRECT_URL
    failure_url = settings.LOGIN_URL
    required_profiles = ['email', 'name']

    model = get_user_model()

    def get(self, request, *args, **kwargs):

        provider = kwargs.get('provider')
        success_url = request.GET.get('next', self.success_url)

        if provider == 'naver':
            csrf_token = request.GET.get('state')
            code = request.GET.get('code')
            if not _compare_salted_tokens(csrf_token, request.COOKIES.get('csrftoken')):
                messages.error(request, 'ì˜ëª»ëœ ê²½ë¡œë¡œ ë¡œê·¸ì¸í•˜ì…¨ìŠµë‹ˆë‹¤.', extra_tags='danger')
                return HttpResponseRedirect(self.failure_url)
            is_success, error = self.login_with_naver(csrf_token, code)
            if not is_success:
                messages.error(request, error, extra_tags='danger')
            return HttpResponseRedirect(success_url if is_success else self.failure_url)

        return HttpResponseRedirect(self.failure_url)

    def set_session(self, **kwargs):
        for key, value in kwargs.items():
            self.request.session[key] = value
```

ê°„ë‹¨í•˜ê²Œ `success_url = request.GET.get('next', self.success_url)` ë¡œ ì§€ì—­ë³€ìˆ˜ success_url ì„ ì •ì˜í–ˆìŠµë‹ˆë‹¤. ì†Œì…œë¡œê·¸ì¸ì´ ì„±ê³µí•œ ì´í›„ì— ì´ success_url ì§€ì—­ë³€ìˆ˜ë¥¼ ì´ìš©í•´ ì´ë™í•˜ë„ë¡ ë³€ê²½í–ˆìŠµë‹ˆë‹¤. 

ì´ì œ ë¡œê·¸ì•„ì›ƒ ì´í›„ ìƒˆ ê²Œì‹œê¸€ ì‘ì„± ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì •ìƒì ìœ¼ë¡œ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™ë˜ê³ , ì†Œì…œë¡œê·¸ì¸ì„ í•˜ë”ë¼ë„ ë¡œê·¸ì¸ ì´í›„ ê²Œì‹œê¸€ ì‘ì„± í™”ë©´ìœ¼ë¡œ ì´ë™ë©ë‹ˆë‹¤.

### urlpatterns ì¶”ê°€ ë“±ë¡
`SocialLoginCallbackView` ëŠ” ì•ì„œ ì‚´í´ ë³¸ ëŒ€ë¡œ ëª¨ë“  í”„ë¡œë°”ì´ë”ë“¤ì„ ëª¨ë‘ ì²˜ë¦¬í•˜ë„ë¡ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë¬¼ë¡  ë„¤ì´ë²„ ì´ì™¸ì˜ ë‹¤ë¥¸ í”„ë¡œë°”ì´ë”ëŠ” ì•„ì§ ë¯¸êµ¬í˜„ ìƒíƒœì´ì§€ë§Œ ì—¬ëŸ¬ë¶„ë“¤ì´ ê³§ë°”ë¡œ ì¶”ê°€í•  í…Œë‹ˆê¹Œìš”.^^ `urlpatterns` ì— ì—¬ëŸ¬ë¶„ë“¤ì´ ê°œë°œí•œ `SocialLoginCallbackView` ë¥¼ ë“±ë¡í•˜ë©´ ì†Œì…œë¡œê·¸ì¸ ê¸°ëŠ¥ì´ ì™„ë£Œë©ë‹ˆë‹¤.
```python
# minitutorial/urls.py

from django.contrib import admin
from django.contrib.auth.views import LogoutView
from django.urls import path

from bbs.views import hello, ArticleListView, ArticleDetailView, ArticleCreateUpdateView
from user.views import UserRegistrationView, UserLoginView, UserVerificationView, ResendVerifyEmailView, SocialLoginCallbackView

urlpatterns = [
    path('hello/<to>', hello), 

    path('article/', ArticleListView.as_view(), name='article-list'),
    path('article/create/', ArticleCreateUpdateView.as_view()),
    path('article/<article_id>/', ArticleDetailView.as_view()),
    path('article/<article_id>/update/', ArticleCreateUpdateView.as_view()),

    path('user/create/', UserRegistrationView.as_view()),
    path('user/<pk>/verify/<token>/', UserVerificationView.as_view()),
    path('user/resend_verify_email/', ResendVerifyEmailView.as_view()),
    path('user/login/', UserLoginView.as_view()),
    path('user/logout/', LogoutView.as_view()),
    path('user/login/social/<provider>/callback/', SocialLoginCallbackView.as_view()),

    path('admin/', admin.site.urls),
]
```

êµ³ì´ í•˜ë‚˜ì˜ í´ë˜ìŠ¤ì— êµ¬í˜„í•œ ì´ìœ ëŠ” í´ë˜ìŠ¤ë¥¼ ì¢€ ë” ì¼ë°˜ì (general)ì¸ í˜•íƒœë¡œ êµ¬í˜„í•˜ë ¤ê³  ì„¤ê³„í•˜ë‹¤ë³´ë‹ˆ ì´ë ‡ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì§€ê¸ˆì´ë¼ë„ ë„¤ì´ë²„ ì „ìš© ì½œë°± í´ë˜ìŠ¤ë¡œ ë³€í˜•í•´ë„ ë‚˜ì˜ì§€ ì•Šì§€ë§Œ ì—¬ëŸ¬ë¶„ë“¤ì—ê²Œ ìˆ™ì œë¡œ ë‚¨ê²¨ë“œë¦½ë‹ˆë‹¤.

ì´ì œ ì•„ê¹Œ callback í˜ì´ì§€ê°€ ì—†ì–´ì„œ ì˜¤ë¥˜ê°€ ë‚œ í™”ë©´ì—ì„œ ìƒˆë¡œê³ ì¹¨ì„ í•´ë³´ì‹œê±°ë‚˜ ë‹¤ì‹œ ë¡œê·¸ì¸í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ì…”ì„œ ë„¤ì´ë²„ ì†Œì…œë¡œê·¸ì¸ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”. ì •ìƒì ìœ¼ë¡œ ë¡œê·¸ì¸ì´ ë˜ì—ˆë‹¤ë©´ ~~ë³µë¶™~~ ì˜ ë”°ë¼í•˜ì‹  ê²ƒì…ë‹ˆë‹¤.

## 2. íšŒì›ê°€ì… í™”ë©´ì— ì†Œì…œë¡œê·¸ì¸ ì¶”ê°€

íšŒì›ê°€ì…í•  ë•Œë„ ì†Œì…œë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ì œê³µí•´ì£¼ë©´ ì‚¬ìš©ìë“¤ì˜ ê°€ì…ì´ í›¨ì”¬ í¸í•´ì§ˆ ê²ƒì…ë‹ˆë‹¤. ì´ë¯¸ ì†Œì…œë¡œê·¸ì¸ ê¸°ëŠ¥ì€ ë‹¤ êµ¬í˜„ëœ ìƒíƒœì´ê¸° ë•Œë¬¸ì— **íšŒì›ê°€ì… í…œí”Œë¦¿ë§Œ ìˆ˜ì •**í•´ì£¼ë©´ ë©ë‹ˆë‹¤.
```html
<!-- user/templates/registration_form.html -->

{% raw %}
{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block title %}<title>íšŒì› ê°€ì…</title>{% endblock %}

{% block css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'user/css/user.css' %}">
{% endblock css %}

{% block content %}

{% include 'user/partials/social_login_panel.html' %}

<div class="panel panel-default user-panel">
    <div class="panel-heading">
        ê°€ì…í•˜ê¸°
    </div>
    <div class="panel-body">
        <form action="." method="post">
            {% csrf_token %}
            {% include 'user/partials/form_field.html' with form=form %}
            <div class="form-actions">
                <button class="btn btn-primary btn-large" type="submit">ê°€ì…í•˜ê¸°</button>
            </div>
        </form>
    </div>
</div>
{% endblock content %}
{% endraw %}
```
`include` í…œí”Œë¦¿íƒœê·¸ í•˜ë‚˜ë¡œ ì†Œì…œë¡œê·¸ì¸ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.ğŸ˜ íšŒì›ê°€ì… í™”ë©´ì—ì„œëŠ” ì†Œì…œë¡œê·¸ì¸ í™”ë©´ì„ ì¡°ê¸ˆ ë‹¤ë¥´ê²Œ í•˜ê³  ì‹¶ë‹¤ë©´ `include` í•˜ì§€ ì•Šê³  ìƒˆë¡œ êµ¬í˜„í•˜ì…”ë„ ìƒê´€ì—†ìŠµë‹ˆë‹¤. ë§Œì•½ íšŒì›ê°€ì… í™”ë©´ì—ì„œë„ íŒ¨ë„ì´ë¦„ìœ¼ë¡œ ì†Œì…œë¡œê·¸ì¸ ì´ë¼ê³  í‘œì‹œë˜ëŠ” ê²ƒì´ ë³´ê¸° ì‹«ìœ¼ì‹œë‹¤ë©´ ì¸ìë¡œ `include` í…œí”Œë¦¿ íƒœê·¸ì— `with` í‚¤ì›Œë“œë¡œ íŒ¨ë„ì´ë¦„ì„ ë„˜ê²¨ì£¼ì…”ë„ ì¢‹ìŠµë‹ˆë‹¤. ê¸°ì™• ë§ì´ ë‚˜ì™”ìœ¼ë‹ˆ ë¦¬íŒ©í† ë§ì„ í•˜ë„ë¡ í•˜ì£ . ë¨¼ì € `social_login_panel.html` í…œí”Œë¦¿ì—ì„œ `panel_name` ì´ë¼ëŠ” ë³€ìˆ˜ë¡œ ì†Œì…œë¡œê·¸ì¸ ì´ë¼ëŠ” í…ìŠ¤íŠ¸ë¥¼ ëŒ€ì²´í•©ë‹ˆë‹¤.

```html
<!-- user/templates/user/partials/form_field.html -->

{% raw %}
{% load static %}

{% static 'user/img/kakao_login.png' as kakao_button %}
{% static 'user/img/kakao_login_ov.png' as kakao_button_hover %}
{% static 'user/img/naver_login_green.png' as naver_button %}
{% static 'user/img/naver_login_white.png' as naver_button_hover %}

<div class="panel panel-default user-panel">
    <div class="panel-heading">
        {{ panel_name }}
    </div>
    <div class="panel-body text-center">
        <div class="pull-left">
            <a>
                <img src="{{ kakao_button }}"
                     onmouseover="this.src='{{ kakao_button_hover }}'"
                     onmouseleave="this.src='{{ kakao_button }}'"height="34">
            </a>
        </div>
        <div class="pull-right">
            <a href="#" onclick="naverLogin()">
                <img src="{{ naver_button }}"
                     onmouseover="this.src='{{ naver_button_hover }}'"
                     onmouseleave="this.src='{{ naver_button }}'"height="34">
            </a>
        </div>
    </div>
</div>
{% endraw %}
```

ì´ì œ `login_form.html` ê³¼ r`egistration_form.html` ì˜ `include` í…œí”Œë¦¿íƒœê·¸ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.

```html
<!-- user/templates/login_form.html -->

<!-- ìƒëµ -->

{% raw %}
{% include 'user/partials/social_login_panel.html' with panel_name='ì†Œì…œë¡œê·¸ì¸' %}

<!-- ìƒëµ -->
```

```html
<!-- user/templates/registration_form.html -->

<!-- ìƒëµ -->

{% include 'user/partials/social_login_panel.html' with panel_name='ì†Œì…œíšŒì›ê°€ì…' %}
{% endraw %}

<!-- ìƒëµ -->
```

ì†Œì…œë¡œê·¸ì¸, ì†Œì…œíšŒì›ê°€ì…ìœ¼ë¡œ ê°ê° ì¸ìë¥¼ ë„˜ê²¨ì£¼ë„ë¡ ìˆ˜ì •í•˜ê³  ë¡œê·¸ì¸ê³¼ íšŒì›ê°€ì… í™”ë©´ì„ ë‹¤ì‹œ í•œë²ˆ ì ‘ì†í•´ë³´ì‹œë©´ ì •ìƒì ìœ¼ë¡œ ì¶œë ¥ì´ ë©ë‹ˆë‹¤.

## 3. ì†Œì…œë¡œê·¸ì¸ ì•± ë¶„ë¦¬

ì†Œì…œë¡œê·¸ì¸ ê¸°ëŠ¥ì„ user ì•±ê³¼ëŠ” ë³„ë„ì˜ ì•±ìœ¼ë¡œ ë¶„ë¦¬í•´ë„ ë˜ê² ì§€ë§Œ ì—¬ê¸°ì„œëŠ” user ì•± ë‚´ë¶€ì— ì†Œì…œë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ë‚´ì¥í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤. ì†Œì…œë¡œê·¸ì¸ ê¸°ëŠ¥ë§Œ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì—ì„œ ì¬ì‚¬ìš©í•˜ê³  ì‹¶ìœ¼ì‹œë‹¤ë©´ ì•„ê¹Œ ìƒì„±í•œ static íŒŒì¼ë“¤ê³¼ ë·°, ê·¸ë¦¬ê³  `oauth` íŒ¨í‚¤ì§€ë¥¼ ë”°ë¡œ ì•±ìœ¼ë¡œ ë¶„ë¦¬í•˜ì…”ë„ ë©ë‹ˆë‹¤. 

> ì‚¬ìš©ë°©ë²•ì€ 3ê°€ì§€ë§Œ í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
> 1. ì„¤ì •íŒŒì¼ì— `AUTHENTICATION_BACKENDS`, `NAVER_CLIENT_ID`, `NAVER_SECRET_KEY` ì„¤ì •
> 2. `urlpatterns` ì— `CallbackView` ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.
> 3. í…œí”Œë¦¿ ìƒì„± ë° `naverLogin()` í˜¸ì¶œ. í…œí”Œë¦¿ì€ ì–´ì©” ìˆ˜ ì—†ìœ¼ë‹ˆ í•´ë‹¹ í”„ë¡œì íŠ¸ì— ë§ê²Œ ìƒì„±í•˜ì‹œê³  ë„¤ì´ë²„ ë¡œê·¸ì¸ ë²„íŠ¼ì˜ `onclick` ì†ì„±ì„ `naverLogin()` ìœ¼ë¡œ ì„¤ì •í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.

ì—¬ê¸°ì„œëŠ” ì•±ì„ ë¶„ë¦¬í•˜ì§€ ì•Šê³  ì¡°ê¸ˆ ë³µì¡í•˜ì§€ë§Œ ì†Œì…œë¡œê·¸ì¸ê³¼ ì‚¬ìš©ì ì•±ì„ í•˜ë‚˜ì˜ ì•±ìœ¼ë¡œ ê´€ë¦¬í•  ì˜ˆì •ì…ë‹ˆë‹¤. í•˜ë‚˜ì˜ ì•±ìœ¼ë¡œ ê´€ë¦¬í•˜ë©´ ì¢‹ì€ ì ì€ ì†Œì…œë¡œê·¸ì¸ ê¸°ëŠ¥ì´ ì‚¬ìš©ì ëª¨ë¸ì— ì–´ëŠì •ë„ ì˜ì¡´ì„±ì´ ìˆê¸° ë•Œë¬¸ì— ë¬¸ì œì˜ ì—¬ì§€ê°€ ì¤„ì–´ë“­ë‹ˆë‹¤. ì˜ˆë¥¼ë“¤ì–´ ì¥ê³  `auth` í”„ë ˆì„ì›Œí¬ì—ì„œ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•˜ëŠ” ì‚¬ìš©ì ëª¨ë¸ì€ ì‚¬ìš©ìì˜ ì´ë¦„ì´ `first_name`, `last_name` ìœ¼ë¡œ ë¶„ë¦¬ë˜ì–´ ìˆìœ¼ë‚˜ ìƒˆë¡œìš´ ì‚¬ìš©ì ëª¨ë¸ì—ì„œëŠ” `name` ì´ë¼ëŠ” í•˜ë‚˜ì˜ í•„ë“œë¡œë§Œ ì œê³µí•˜ê³ , ì†Œì…œë¡œê·¸ì¸í•  ë•Œë„ `name` ì´ë¼ëŠ” í•„ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë§Œì¼ ì‚¬ìš©ì ëª¨ë¸ì— `name` ì´ë¼ëŠ” í•„ë“œê°€ ì—†ë‹¤ë©´ ì˜¤ë¥˜ê°€ ìƒê¸¸í…Œë‹ˆ `NaverLoginMixin` ì„ ìˆ˜ì •í•´ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤. `email` í•„ë“œì˜ ì´ë¦„ì´ ë³€ê²½ë  ê²½ìš°ë„ ë§ˆì°¬ê°€ì§€ì´êµ¬ìš”.

ì‚¬ìš©ì ì•±ì´ ì¸ì¦ ê¸°ëŠ¥ ì œê³µì„ ìœ„í•œ ì•±ì´ê¸° ë•Œë¬¸ì— ì†Œì…œë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ì¶”ê°€í•´ë„ í° ë¬¸ì œëŠ” ì—†ìŠµë‹ˆë‹¤. ê·¸ë ‡ë”ë¼ë„ ì†Œì…œë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ë³„ë„ì˜ ì•±ìœ¼ë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì—¬ì „íˆ ì¢‹ë‹¤ê³  ìƒê°í•˜ëŠ” ê²ƒì´ ì˜ëª»ëœ ìƒê°ì€ ì•„ë‹™ë‹ˆë‹¤. ê¸°ëŠ¥ë³„ë¡œ ê°€ê¸‰ì  **ì•±ì„ ë¶„ë¦¬í•˜ëŠ” ê²ƒì€ ì¢‹ì€ ì•„ì´ë””ì–´ì´ì§€ë§Œ ë¶„ë¦¬ëœ ì•±ì„ ì¬ì‚¬ìš©í•  ë•Œ ë¬¸ì œê°€ ë˜ëŠ” ì ì´ ìˆëŠ” ì§€ ì—†ëŠ” ì§€ ë©´ë°€íˆ ê²€í† í•˜ê³  ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ í™•ì‹¤í•œ ì²˜ë¦¬ë¥¼ í•˜ë„ë¡ ì£¼ì˜**í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.

ì´ê²ƒìœ¼ë¡œ ì¸ì¦ê¸°ëŠ¥ì€ ì—¬ê¸°ì„œ ë§ˆë¬´ë¦¬ í•©ë‹ˆë‹¤. ë‹¤ìŒë²ˆì— ë°°ì›Œë³¼ ê¸°ëŠ¥ì€ ì—¬ëŸ¬ê°€ì§€ë¥¼ ìƒê°í•˜ê³  ìˆëŠ”ë° ê¶Œí•œê´€ë¦¬(Authorization), ë¡œê¹…, íŒŒì¼ì—…ë¡œë“œ(ì¸ë„¤ì¼ í¬í•¨) ë“±ì˜ ì¥ê³  ê¸°ë³¸ê¸°ëŠ¥ì˜ í™œìš©ì´ ìˆìŠµë‹ˆë‹¤. ê°€ëŠ¥í•œ ì‹¤ë¬´ì—ì„œ ë§ì´ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ì„ ì‹¤ë¬´ì—ì„œ ë§ì´ ì‚¬ìš©í•˜ëŠ” í˜•íƒœë¡œ ì†Œê°œí•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤. 

> ì°½ì¡°ì ì¸ ê°œë°œì„ í•˜ë ¤ë©´ ë‚´ê°€ í‹€ë¦´ì§€ë„ ëª¨ë¥¸ë‹¤ëŠ” ê³µí¬ë¥¼ ë²„ë ¤ì•¼ í•œë‹¤
>
> swarf00, ê³µí¬ëŠ” ë– ë‚˜ê°€ê³ ...ì°½ì¡°ì ì¸ ê°œë°œë„ í•˜ëŠ”ë°...ì•¼ê·¼ì€ í•´ì•¼ í•˜ê³ ...ëˆˆë¬¼ì´...ëšëš...